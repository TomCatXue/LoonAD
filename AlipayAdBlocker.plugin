#!name = æ”¯ä»˜å®å°ç¨‹åºå»å¹¿å‘Š (Switchable)
#!desc = å±è”½æ”¯ä»˜å®å¹¿å‘ŠAPIå’Œå°ç¨‹åºæµé‡ä½æ’ä»¶ï¼Œæ”¯æŒå¼€å…³æ§åˆ¶ï¼Œä½œè€…ç½²ååœ¨æ’ä»¶å†…ã€‚
#!openUrl = https://apps.apple.com/app/id333206289
#!author = TomCatXue & å¯è‰ğŸ…¥[https://gitlab.com/lodepuly/vpn_tool/-/blob/master/README.md]
#!raw-url = https://raw.githubusercontent.com/TomCatXue/LoonAD/main/AlipayMiniProgramAdBlock.plugin
#!tag = å»å¹¿å‘Š,æ”¯ä»˜å®
#!system = iOS
#!system_version = 14.0
#!loon_version = 3.2.1(749)
#!homepage = https://github.com/TomCatXue/LoonAD
#!icon = https://gw.alipayobjects.com/zos/rmsportal/UTjFYEzMSYVwzxIGVhMu.png
#!date = 2024-09-27 22:18:09

# ==================================================
# å‚æ•°é…ç½®åŒºï¼ˆå¼€å…³æ§åˆ¶ï¼‰
# ==================================================
[Argument]
enable_main = true
enable_ad_api = true
enable_mini_program = true
enable_common_ads = true
enable_logging = false

# ç‰¹å®šAPIå¼€å…³
block_agentreport = true
block_reportdata = true
block_reportmetric = true
block_promotepage = true
block_taskquery = true

# å°ç¨‹åºç‰¹å®šå¼€å…³
block_miniapp_plugin = true
block_miniapp_traffic = true

# å“åº”æ¨¡å¼é€‰æ‹©
response_mode = reject  # reject|empty|modify

# ==================================================
# è§„åˆ™åŒº
# ==================================================
[Rule]

# æ”¯ä»˜å®é€šç”¨è§„åˆ™
DOMAIN-SUFFIX,alipay.com,DIRECT
DOMAIN-SUFFIX,alipayobjects.com,DIRECT
DOMAIN-SUFFIX,alipaydn.com,DIRECT

# å¹¿å‘Šç›¸å…³åŸŸåå±è”½ï¼ˆä»…åœ¨å¯ç”¨æ—¶ç”Ÿæ•ˆï¼‰
DOMAIN,ad.alipay.com,REJECT,enabled=$enable_ad_api
DOMAIN,ads.alipay.com,REJECT,enabled=$enable_ad_api
DOMAIN,advert.alipay.com,REJECT,enabled=$enable_ad_api
DOMAIN,promotion.alipay.com,REJECT,enabled=$enable_ad_api

# å°ç¨‹åºæµé‡ä½å±è”½
DOMAIN,e.alipay.com,REJECT,enabled=$enable_mini_program
DOMAIN,mr.alipay.com,REJECT,enabled=$enable_mini_program

# ==================================================
# é‡å†™åŒº
# ==================================================
[Rewrite]

# æ ¸å¿ƒå¹¿å‘ŠAPIæ¥å£å±è”½
# alipay.data.dataservice.ad.agentreportdata.query - å¹¿å‘Šä»£ç†å•†æŠ•æ”¾æ•°æ®æŸ¥è¯¢
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\.agentreportdata\.query reject-dict,enabled=$block_agentreport

# alipay.data.dataservice.ad.reportdata.query - å¹¿å‘ŠæŠ•æ”¾æ•°æ®é€šç”¨æŸ¥è¯¢
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\.reportdata\.query reject-dict,enabled=$block_reportdata

# alipay.data.dataservice.ad.reportmetric.query - æ”¯ä»˜å®å¹¿å‘Šå•†å®¶æŒ‡æ ‡æŸ¥è¯¢
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\.reportmetric\.query reject-dict,enabled=$block_reportmetric

# alipay.data.dataservice.ad.promotepage.batchquery - è‡ªå»ºæ¨å¹¿é¡µåˆ—è¡¨æ‰¹é‡æŸ¥è¯¢
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\.promotepage\.batchquery reject-dict,enabled=$block_promotepage

# alipay.data.dataservice.ad.promotepage.download - è‡ªå»ºæ¨å¹¿é¡µç•™èµ„æ•°æ®æŸ¥è¯¢
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\.promotepage\.download reject-dict,enabled=$block_promotepage

# alipay.data.dataservice.xlight.task.query - ä»»åŠ¡å¹¿å‘Šå®ŒæˆçŠ¶æ€æŸ¥è¯¢æ¥å£
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.xlight\.task\.query reject-dict,enabled=$block_taskquery

# é€šç”¨å¹¿å‘ŠAPIæ¨¡å¼åŒ¹é…
^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\..* reject-dict,enabled=$enable_ad_api
^https:\/\/[^\/]+\/alipay\.marketing\..* reject-dict,enabled=$enable_common_ads
^https:\/\/[^\/]+\/alipay\.commerce\.operation\..* reject-dict,enabled=$enable_common_ads

# å°ç¨‹åºæµé‡ä½æ’ä»¶å±è”½
^https:\/\/[^\/]+\/miniapp\/plugin\/.* reject-dict,enabled=$block_miniapp_plugin
^https:\/\/[^\/]+\/miniapp\/traffic\/.* reject-dict,enabled=$block_miniapp_traffic
^https:\/\/[^\/]+\/ams\/plugin\/.* reject-dict,enabled=$block_miniapp_plugin

# å¼€å±å¹¿å‘Šç›¸å…³
^https:\/\/amdc\.alipay\.com\/.* reject-dict,enabled=$enable_common_ads
^https:\/\/adash\.(m|wxs)\.taobao\.com\/.* reject-dict,enabled=$enable_common_ads
^https:\/\/render\.alipay\.com\/.* reject-dict,enabled=$enable_common_ads

# ä¿¡æ¯æµå¹¿å‘Š
^https:\/\/mss\.alipay\.com\/.* reject-dict,enabled=$enable_common_ads

# èš‚èšè¥é”€ç›¸å…³
^https:\/\/antcert\.antgroup\.com\/.* reject-dict,enabled=$enable_common_ads
^https:\/\/certify\.alipay\.com\/.* reject-dict,enabled=$enable_common_ads

# ==================================================
# è„šæœ¬åŒºï¼ˆé«˜çº§å¤„ç†ï¼‰
# ==================================================
[Script]

# æ”¯ä»˜å®å¹¿å‘Šæ ¸å¿ƒå¤„ç†è„šæœ¬
http-response ^https:\/\/[^\/]+\/alipay\.data\.dataservice\.ad\..* requires-body=true, script-path=https://raw.githubusercontent.com/TomCatXue/LoonAD/main/Scripts/AlipayADCore.js, tag=æ”¯ä»˜å®å¹¿å‘Šæ ¸å¿ƒå¤„ç†, argument=response_mode=$response_mode&logging=$enable_logging, timeout=30

# å°ç¨‹åºæµé‡ä½å¤„ç†è„šæœ¬
http-response ^https:\/\/[^\/]+\/(miniapp\/plugin|miniapp\/traffic|ams\/plugin) requires-body=true, script-path=https://raw.githubusercontent.com/TomCatXue/LoonAD/main/Scripts/AlipayMiniPlugin.js, tag=æ”¯ä»˜å®å°ç¨‹åºæ’ä»¶å¤„ç†, argument=logging=$enable_logging, timeout=30

# æ”¯ä»˜å®å¼€å±å¹¿å‘Šå¤„ç†
http-response ^https:\/\/(amdc|adash|render)\.(alipay|taobao)\.com requires-body=true, script-path=https://raw.githubusercontent.com/TomCatXue/LoonAD/main/Scripts/AlipaySplash.js, tag=æ”¯ä»˜å®å¼€å±å¹¿å‘Šå¤„ç†, argument=logging=$enable_logging, timeout=30

# ==================================================
# MITMé…ç½®
# ==================================================
[MitM]
hostname = 
    *.alipay.com,
    *.alipayobjects.com,
    *.alipaydn.com,
    *.taobao.com,
    *.alicdn.com,
    *.antgroup.com,
    *.tanx.com,
    *.alimama.com,
    *.mmstat.com

# æ³¨ï¼šéœ€è¦å¼€å¯Loonçš„MITMåŠŸèƒ½å¹¶å®‰è£…å¯¹åº”è¯ä¹¦
